{"ast":null,"code":"import _objectSpread from \"F:/\\u7EFC\\u5408/\\u4E2A\\u4EBA/\\u4F5C\\u4E1A/\\u4E3B\\u8BFE/\\u5927\\u4E09/web\\u5F00\\u53D1/homework/front/React_Quiz/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { useEffect, useRef, useState } from 'react';\nimport getFixScaleEleTransPosition from \"../getFixScaleEleTransPosition\";\nfunction getDistance(a, b) {\n  const x = a.x - b.x;\n  const y = a.y - b.y;\n  return Math.hypot(x, y);\n}\nfunction getCenter(oldPoint1, oldPoint2, newPoint1, newPoint2) {\n  // Calculate the distance each point has moved\n  const distance1 = getDistance(oldPoint1, newPoint1);\n  const distance2 = getDistance(oldPoint2, newPoint2);\n\n  // If both distances are 0, return the original points\n  if (distance1 === 0 && distance2 === 0) {\n    return [oldPoint1.x, oldPoint1.y];\n  }\n\n  // Calculate the ratio of the distances\n  const ratio = distance1 / (distance1 + distance2);\n\n  // Calculate the new center point based on the ratio\n  const x = oldPoint1.x + ratio * (oldPoint2.x - oldPoint1.x);\n  const y = oldPoint1.y + ratio * (oldPoint2.y - oldPoint1.y);\n  return [x, y];\n}\nexport default function useTouchEvent(imgRef, movable, open, minScale, transform, updateTransform, dispatchZoomChange) {\n  const {\n    rotate,\n    scale,\n    x,\n    y\n  } = transform;\n  const [isTouching, setIsTouching] = useState(false);\n  const touchPointInfo = useRef({\n    point1: {\n      x: 0,\n      y: 0\n    },\n    point2: {\n      x: 0,\n      y: 0\n    },\n    eventType: 'none'\n  });\n  const updateTouchPointInfo = values => {\n    touchPointInfo.current = _objectSpread(_objectSpread({}, touchPointInfo.current), values);\n  };\n  const onTouchStart = event => {\n    if (!movable) return;\n    event.stopPropagation();\n    setIsTouching(true);\n    const {\n      touches = []\n    } = event;\n    if (touches.length > 1) {\n      // touch zoom\n      updateTouchPointInfo({\n        point1: {\n          x: touches[0].clientX,\n          y: touches[0].clientY\n        },\n        point2: {\n          x: touches[1].clientX,\n          y: touches[1].clientY\n        },\n        eventType: 'touchZoom'\n      });\n    } else {\n      // touch move\n      updateTouchPointInfo({\n        point1: {\n          x: touches[0].clientX - x,\n          y: touches[0].clientY - y\n        },\n        eventType: 'move'\n      });\n    }\n  };\n  const onTouchMove = event => {\n    const {\n      touches = []\n    } = event;\n    const {\n      point1,\n      point2,\n      eventType\n    } = touchPointInfo.current;\n    if (touches.length > 1 && eventType === 'touchZoom') {\n      // touch zoom\n      const newPoint1 = {\n        x: touches[0].clientX,\n        y: touches[0].clientY\n      };\n      const newPoint2 = {\n        x: touches[1].clientX,\n        y: touches[1].clientY\n      };\n      const [centerX, centerY] = getCenter(point1, point2, newPoint1, newPoint2);\n      const ratio = getDistance(newPoint1, newPoint2) / getDistance(point1, point2);\n      dispatchZoomChange(ratio, 'touchZoom', centerX, centerY, true);\n      updateTouchPointInfo({\n        point1: newPoint1,\n        point2: newPoint2,\n        eventType: 'touchZoom'\n      });\n    } else if (eventType === 'move') {\n      // touch move\n      updateTransform({\n        x: touches[0].clientX - point1.x,\n        y: touches[0].clientY - point1.y\n      }, 'move');\n      updateTouchPointInfo({\n        eventType: 'move'\n      });\n    }\n  };\n  const onTouchEnd = () => {\n    if (!open) return;\n    if (isTouching) {\n      setIsTouching(false);\n    }\n    updateTouchPointInfo({\n      eventType: 'none'\n    });\n    if (minScale > scale) {\n      /** When the scaling ratio is less than the minimum scaling ratio, reset the scaling ratio */\n      return updateTransform({\n        x: 0,\n        y: 0,\n        scale: minScale\n      }, 'touchZoom');\n    }\n    const width = imgRef.current.offsetWidth * scale;\n    const height = imgRef.current.offsetHeight * scale;\n    // eslint-disable-next-line @typescript-eslint/no-shadow\n    const {\n      left,\n      top\n    } = imgRef.current.getBoundingClientRect();\n    const isRotate = rotate % 180 !== 0;\n    const fixState = getFixScaleEleTransPosition(isRotate ? height : width, isRotate ? width : height, left, top);\n    if (fixState) {\n      updateTransform(_objectSpread({}, fixState), 'dragRebound');\n    }\n  };\n  useEffect(() => {\n    const preventDefault = e => {\n      e.preventDefault();\n    };\n    if (open && movable) {\n      window.addEventListener('touchmove', preventDefault, {\n        passive: false\n      });\n    }\n    return () => {\n      window.removeEventListener('touchmove', preventDefault);\n    };\n  }, [open, movable]);\n  return {\n    isTouching,\n    onTouchStart,\n    onTouchMove,\n    onTouchEnd\n  };\n}","map":{"version":3,"names":["useEffect","useRef","useState","getFixScaleEleTransPosition","getDistance","a","b","x","y","Math","hypot","getCenter","oldPoint1","oldPoint2","newPoint1","newPoint2","distance1","distance2","ratio","useTouchEvent","imgRef","movable","open","minScale","transform","updateTransform","dispatchZoomChange","rotate","scale","isTouching","setIsTouching","touchPointInfo","point1","point2","eventType","updateTouchPointInfo","values","current","_objectSpread","onTouchStart","event","stopPropagation","touches","length","clientX","clientY","onTouchMove","centerX","centerY","onTouchEnd","width","offsetWidth","height","offsetHeight","left","top","getBoundingClientRect","isRotate","fixState","preventDefault","e","window","addEventListener","passive","removeEventListener"],"sources":["F:/综合/个人/作业/主课/大三/web开发/homework/front/React_Quiz/node_modules/@rc-component/image/es/hooks/useTouchEvent.js"],"sourcesContent":["import { useEffect, useRef, useState } from 'react';\nimport getFixScaleEleTransPosition from \"../getFixScaleEleTransPosition\";\nfunction getDistance(a, b) {\n  const x = a.x - b.x;\n  const y = a.y - b.y;\n  return Math.hypot(x, y);\n}\nfunction getCenter(oldPoint1, oldPoint2, newPoint1, newPoint2) {\n  // Calculate the distance each point has moved\n  const distance1 = getDistance(oldPoint1, newPoint1);\n  const distance2 = getDistance(oldPoint2, newPoint2);\n\n  // If both distances are 0, return the original points\n  if (distance1 === 0 && distance2 === 0) {\n    return [oldPoint1.x, oldPoint1.y];\n  }\n\n  // Calculate the ratio of the distances\n  const ratio = distance1 / (distance1 + distance2);\n\n  // Calculate the new center point based on the ratio\n  const x = oldPoint1.x + ratio * (oldPoint2.x - oldPoint1.x);\n  const y = oldPoint1.y + ratio * (oldPoint2.y - oldPoint1.y);\n  return [x, y];\n}\nexport default function useTouchEvent(imgRef, movable, open, minScale, transform, updateTransform, dispatchZoomChange) {\n  const {\n    rotate,\n    scale,\n    x,\n    y\n  } = transform;\n  const [isTouching, setIsTouching] = useState(false);\n  const touchPointInfo = useRef({\n    point1: {\n      x: 0,\n      y: 0\n    },\n    point2: {\n      x: 0,\n      y: 0\n    },\n    eventType: 'none'\n  });\n  const updateTouchPointInfo = values => {\n    touchPointInfo.current = {\n      ...touchPointInfo.current,\n      ...values\n    };\n  };\n  const onTouchStart = event => {\n    if (!movable) return;\n    event.stopPropagation();\n    setIsTouching(true);\n    const {\n      touches = []\n    } = event;\n    if (touches.length > 1) {\n      // touch zoom\n      updateTouchPointInfo({\n        point1: {\n          x: touches[0].clientX,\n          y: touches[0].clientY\n        },\n        point2: {\n          x: touches[1].clientX,\n          y: touches[1].clientY\n        },\n        eventType: 'touchZoom'\n      });\n    } else {\n      // touch move\n      updateTouchPointInfo({\n        point1: {\n          x: touches[0].clientX - x,\n          y: touches[0].clientY - y\n        },\n        eventType: 'move'\n      });\n    }\n  };\n  const onTouchMove = event => {\n    const {\n      touches = []\n    } = event;\n    const {\n      point1,\n      point2,\n      eventType\n    } = touchPointInfo.current;\n    if (touches.length > 1 && eventType === 'touchZoom') {\n      // touch zoom\n      const newPoint1 = {\n        x: touches[0].clientX,\n        y: touches[0].clientY\n      };\n      const newPoint2 = {\n        x: touches[1].clientX,\n        y: touches[1].clientY\n      };\n      const [centerX, centerY] = getCenter(point1, point2, newPoint1, newPoint2);\n      const ratio = getDistance(newPoint1, newPoint2) / getDistance(point1, point2);\n      dispatchZoomChange(ratio, 'touchZoom', centerX, centerY, true);\n      updateTouchPointInfo({\n        point1: newPoint1,\n        point2: newPoint2,\n        eventType: 'touchZoom'\n      });\n    } else if (eventType === 'move') {\n      // touch move\n      updateTransform({\n        x: touches[0].clientX - point1.x,\n        y: touches[0].clientY - point1.y\n      }, 'move');\n      updateTouchPointInfo({\n        eventType: 'move'\n      });\n    }\n  };\n  const onTouchEnd = () => {\n    if (!open) return;\n    if (isTouching) {\n      setIsTouching(false);\n    }\n    updateTouchPointInfo({\n      eventType: 'none'\n    });\n    if (minScale > scale) {\n      /** When the scaling ratio is less than the minimum scaling ratio, reset the scaling ratio */\n      return updateTransform({\n        x: 0,\n        y: 0,\n        scale: minScale\n      }, 'touchZoom');\n    }\n    const width = imgRef.current.offsetWidth * scale;\n    const height = imgRef.current.offsetHeight * scale;\n    // eslint-disable-next-line @typescript-eslint/no-shadow\n    const {\n      left,\n      top\n    } = imgRef.current.getBoundingClientRect();\n    const isRotate = rotate % 180 !== 0;\n    const fixState = getFixScaleEleTransPosition(isRotate ? height : width, isRotate ? width : height, left, top);\n    if (fixState) {\n      updateTransform({\n        ...fixState\n      }, 'dragRebound');\n    }\n  };\n  useEffect(() => {\n    const preventDefault = e => {\n      e.preventDefault();\n    };\n    if (open && movable) {\n      window.addEventListener('touchmove', preventDefault, {\n        passive: false\n      });\n    }\n    return () => {\n      window.removeEventListener('touchmove', preventDefault);\n    };\n  }, [open, movable]);\n  return {\n    isTouching,\n    onTouchStart,\n    onTouchMove,\n    onTouchEnd\n  };\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}