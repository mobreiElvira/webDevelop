{"ast":null,"code":"import _objectSpread from \"F:/\\u7EFC\\u5408/\\u4E2A\\u4EBA/\\u4F5C\\u4E1A/\\u4E3B\\u8BFE/\\u5927\\u4E09/web\\u5F00\\u53D1/homework/front/React_Quiz/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport { warning } from \"@rc-component/util/es/warning\";\nimport { useEffect, useRef, useState } from 'react';\nimport getFixScaleEleTransPosition from \"../getFixScaleEleTransPosition\";\nimport { BASE_SCALE_RATIO, WHEEL_MAX_SCALE_RATIO } from \"../previewConfig\";\nexport default function useMouseEvent(imgRef, movable, open, scaleStep, transform, updateTransform, dispatchZoomChange) {\n  const {\n    rotate,\n    scale,\n    x,\n    y\n  } = transform;\n  const [isMoving, setMoving] = useState(false);\n  const startPositionInfo = useRef({\n    diffX: 0,\n    diffY: 0,\n    transformX: 0,\n    transformY: 0\n  });\n  const onMouseDown = event => {\n    // Only allow main button\n    if (!movable || event.button !== 0) return;\n    event.preventDefault();\n    event.stopPropagation();\n    startPositionInfo.current = {\n      diffX: event.pageX - x,\n      diffY: event.pageY - y,\n      transformX: x,\n      transformY: y\n    };\n    setMoving(true);\n  };\n  const onMouseMove = event => {\n    if (open && isMoving) {\n      updateTransform({\n        x: event.pageX - startPositionInfo.current.diffX,\n        y: event.pageY - startPositionInfo.current.diffY\n      }, 'move');\n    }\n  };\n  const onMouseUp = () => {\n    if (open && isMoving) {\n      setMoving(false);\n\n      /** No need to restore the position when the picture is not moved, So as not to interfere with the click */\n      const {\n        transformX,\n        transformY\n      } = startPositionInfo.current;\n      const hasChangedPosition = x !== transformX && y !== transformY;\n      if (!hasChangedPosition) return;\n      const width = imgRef.current.offsetWidth * scale;\n      const height = imgRef.current.offsetHeight * scale;\n      // eslint-disable-next-line @typescript-eslint/no-shadow\n      const {\n        left,\n        top\n      } = imgRef.current.getBoundingClientRect();\n      const isRotate = rotate % 180 !== 0;\n      const fixState = getFixScaleEleTransPosition(isRotate ? height : width, isRotate ? width : height, left, top);\n      if (fixState) {\n        updateTransform(_objectSpread({}, fixState), 'dragRebound');\n      }\n    }\n  };\n  const onWheel = event => {\n    if (!open || event.deltaY == 0) return;\n    // Scale ratio depends on the deltaY size\n    const scaleRatio = Math.abs(event.deltaY / 100);\n    // Limit the maximum scale ratio\n    const mergedScaleRatio = Math.min(scaleRatio, WHEEL_MAX_SCALE_RATIO);\n    // Scale the ratio each time\n    let ratio = BASE_SCALE_RATIO + mergedScaleRatio * scaleStep;\n    if (event.deltaY > 0) {\n      ratio = BASE_SCALE_RATIO / ratio;\n    }\n    dispatchZoomChange(ratio, 'wheel', event.clientX, event.clientY);\n  };\n  useEffect(() => {\n    if (movable) {\n      window.addEventListener('mouseup', onMouseUp, false);\n      window.addEventListener('mousemove', onMouseMove, false);\n      try {\n        // Resolve if in iframe lost event\n        /* istanbul ignore next */\n        if (window.top !== window.self) {\n          window.top.addEventListener('mouseup', onMouseUp, false);\n          window.top.addEventListener('mousemove', onMouseMove, false);\n        }\n      } catch (error) {\n        /* istanbul ignore next */\n        warning(false, \"[rc-image] \".concat(error));\n      }\n    }\n    return () => {\n      var _window$top, _window$top2;\n      window.removeEventListener('mouseup', onMouseUp);\n      window.removeEventListener('mousemove', onMouseMove);\n      // /* istanbul ignore next */\n      (_window$top = window.top) === null || _window$top === void 0 || _window$top.removeEventListener('mouseup', onMouseUp);\n      // /* istanbul ignore next */\n      (_window$top2 = window.top) === null || _window$top2 === void 0 || _window$top2.removeEventListener('mousemove', onMouseMove);\n    };\n  }, [open, isMoving, x, y, rotate, movable]);\n  return {\n    isMoving,\n    onMouseDown,\n    onMouseMove,\n    onMouseUp,\n    onWheel\n  };\n}","map":{"version":3,"names":["warning","useEffect","useRef","useState","getFixScaleEleTransPosition","BASE_SCALE_RATIO","WHEEL_MAX_SCALE_RATIO","useMouseEvent","imgRef","movable","open","scaleStep","transform","updateTransform","dispatchZoomChange","rotate","scale","x","y","isMoving","setMoving","startPositionInfo","diffX","diffY","transformX","transformY","onMouseDown","event","button","preventDefault","stopPropagation","current","pageX","pageY","onMouseMove","onMouseUp","hasChangedPosition","width","offsetWidth","height","offsetHeight","left","top","getBoundingClientRect","isRotate","fixState","_objectSpread","onWheel","deltaY","scaleRatio","Math","abs","mergedScaleRatio","min","ratio","clientX","clientY","window","addEventListener","self","error","concat","_window$top","_window$top2","removeEventListener"],"sources":["F:/综合/个人/作业/主课/大三/web开发/homework/front/React_Quiz/node_modules/@rc-component/image/es/hooks/useMouseEvent.js"],"sourcesContent":["import { warning } from \"@rc-component/util/es/warning\";\nimport { useEffect, useRef, useState } from 'react';\nimport getFixScaleEleTransPosition from \"../getFixScaleEleTransPosition\";\nimport { BASE_SCALE_RATIO, WHEEL_MAX_SCALE_RATIO } from \"../previewConfig\";\nexport default function useMouseEvent(imgRef, movable, open, scaleStep, transform, updateTransform, dispatchZoomChange) {\n  const {\n    rotate,\n    scale,\n    x,\n    y\n  } = transform;\n  const [isMoving, setMoving] = useState(false);\n  const startPositionInfo = useRef({\n    diffX: 0,\n    diffY: 0,\n    transformX: 0,\n    transformY: 0\n  });\n  const onMouseDown = event => {\n    // Only allow main button\n    if (!movable || event.button !== 0) return;\n    event.preventDefault();\n    event.stopPropagation();\n    startPositionInfo.current = {\n      diffX: event.pageX - x,\n      diffY: event.pageY - y,\n      transformX: x,\n      transformY: y\n    };\n    setMoving(true);\n  };\n  const onMouseMove = event => {\n    if (open && isMoving) {\n      updateTransform({\n        x: event.pageX - startPositionInfo.current.diffX,\n        y: event.pageY - startPositionInfo.current.diffY\n      }, 'move');\n    }\n  };\n  const onMouseUp = () => {\n    if (open && isMoving) {\n      setMoving(false);\n\n      /** No need to restore the position when the picture is not moved, So as not to interfere with the click */\n      const {\n        transformX,\n        transformY\n      } = startPositionInfo.current;\n      const hasChangedPosition = x !== transformX && y !== transformY;\n      if (!hasChangedPosition) return;\n      const width = imgRef.current.offsetWidth * scale;\n      const height = imgRef.current.offsetHeight * scale;\n      // eslint-disable-next-line @typescript-eslint/no-shadow\n      const {\n        left,\n        top\n      } = imgRef.current.getBoundingClientRect();\n      const isRotate = rotate % 180 !== 0;\n      const fixState = getFixScaleEleTransPosition(isRotate ? height : width, isRotate ? width : height, left, top);\n      if (fixState) {\n        updateTransform({\n          ...fixState\n        }, 'dragRebound');\n      }\n    }\n  };\n  const onWheel = event => {\n    if (!open || event.deltaY == 0) return;\n    // Scale ratio depends on the deltaY size\n    const scaleRatio = Math.abs(event.deltaY / 100);\n    // Limit the maximum scale ratio\n    const mergedScaleRatio = Math.min(scaleRatio, WHEEL_MAX_SCALE_RATIO);\n    // Scale the ratio each time\n    let ratio = BASE_SCALE_RATIO + mergedScaleRatio * scaleStep;\n    if (event.deltaY > 0) {\n      ratio = BASE_SCALE_RATIO / ratio;\n    }\n    dispatchZoomChange(ratio, 'wheel', event.clientX, event.clientY);\n  };\n  useEffect(() => {\n    if (movable) {\n      window.addEventListener('mouseup', onMouseUp, false);\n      window.addEventListener('mousemove', onMouseMove, false);\n      try {\n        // Resolve if in iframe lost event\n        /* istanbul ignore next */\n        if (window.top !== window.self) {\n          window.top.addEventListener('mouseup', onMouseUp, false);\n          window.top.addEventListener('mousemove', onMouseMove, false);\n        }\n      } catch (error) {\n        /* istanbul ignore next */\n        warning(false, `[rc-image] ${error}`);\n      }\n    }\n    return () => {\n      window.removeEventListener('mouseup', onMouseUp);\n      window.removeEventListener('mousemove', onMouseMove);\n      // /* istanbul ignore next */\n      window.top?.removeEventListener('mouseup', onMouseUp);\n      // /* istanbul ignore next */\n      window.top?.removeEventListener('mousemove', onMouseMove);\n    };\n  }, [open, isMoving, x, y, rotate, movable]);\n  return {\n    isMoving,\n    onMouseDown,\n    onMouseMove,\n    onMouseUp,\n    onWheel\n  };\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}