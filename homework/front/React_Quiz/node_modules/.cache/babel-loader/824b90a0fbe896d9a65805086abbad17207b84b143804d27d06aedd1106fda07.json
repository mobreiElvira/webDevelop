{"ast":null,"code":"import warning from \"@rc-component/util/es/warning\";\nimport { useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport FieldContext, { HOOK_MARK } from \"./FieldContext\";\nimport { isFormInstance } from \"./utils/typeUtil\";\nimport { getNamePath, getValue } from \"./utils/valueUtil\";\nimport { useEvent } from '@rc-component/util';\nexport function stringify(value) {\n  try {\n    return JSON.stringify(value);\n  } catch (_unused) {\n    return Math.random();\n  }\n}\n\n// ------- selector type -------\n\n// ------- selector type end -------\n\nfunction useWatch() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n  const [dependencies, _form = {}] = args;\n  const options = isFormInstance(_form) ? {\n    form: _form\n  } : _form;\n  const form = options.form;\n  const [value, setValue] = useState(() => typeof dependencies === 'function' ? dependencies({}) : undefined);\n  const valueStr = useMemo(() => stringify(value), [value]);\n  const valueStrRef = useRef(valueStr);\n  valueStrRef.current = valueStr;\n  const fieldContext = useContext(FieldContext);\n  const formInstance = form || fieldContext;\n  const isValidForm = formInstance && formInstance._init;\n\n  // Warning if not exist form instance\n  if (process.env.NODE_ENV !== 'production') {\n    warning(args.length === 2 ? form ? isValidForm : true : isValidForm, 'useWatch requires a form instance since it can not auto detect from context.');\n  }\n\n  // ============================== Form ==============================\n  const {\n    getFieldsValue,\n    getInternalHooks\n  } = formInstance;\n  const {\n    registerWatch\n  } = getInternalHooks(HOOK_MARK);\n\n  // ============================= Update =============================\n  const triggerUpdate = useEvent((values, allValues) => {\n    const watchValue = options.preserve ? allValues !== null && allValues !== void 0 ? allValues : getFieldsValue(true) : values !== null && values !== void 0 ? values : getFieldsValue();\n    const nextValue = typeof dependencies === 'function' ? dependencies(watchValue) : getValue(watchValue, getNamePath(dependencies));\n    if (stringify(value) !== stringify(nextValue)) {\n      setValue(nextValue);\n    }\n  });\n\n  // ============================= Effect =============================\n  const flattenDeps = typeof dependencies === 'function' ? dependencies : JSON.stringify(dependencies);\n\n  // Deps changed\n  useEffect(() => {\n    // Skip if not exist form instance\n    if (!isValidForm) {\n      return;\n    }\n    triggerUpdate();\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isValidForm, flattenDeps]);\n\n  // Value changed\n  useEffect(() => {\n    // Skip if not exist form instance\n    if (!isValidForm) {\n      return;\n    }\n    const cancelRegister = registerWatch((values, allValues) => {\n      triggerUpdate(values, allValues);\n    });\n    return cancelRegister;\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isValidForm]);\n  return value;\n}\nexport default useWatch;","map":{"version":3,"names":["warning","useContext","useEffect","useMemo","useRef","useState","FieldContext","HOOK_MARK","isFormInstance","getNamePath","getValue","useEvent","stringify","value","JSON","_unused","Math","random","useWatch","_len","arguments","length","args","Array","_key","dependencies","_form","options","form","setValue","undefined","valueStr","valueStrRef","current","fieldContext","formInstance","isValidForm","_init","process","env","NODE_ENV","getFieldsValue","getInternalHooks","registerWatch","triggerUpdate","values","allValues","watchValue","preserve","nextValue","flattenDeps","cancelRegister"],"sources":["F:/综合/个人/作业/主课/大三/web开发/homework/front/React_Quiz/node_modules/@rc-component/form/es/useWatch.js"],"sourcesContent":["import warning from \"@rc-component/util/es/warning\";\nimport { useContext, useEffect, useMemo, useRef, useState } from 'react';\nimport FieldContext, { HOOK_MARK } from \"./FieldContext\";\nimport { isFormInstance } from \"./utils/typeUtil\";\nimport { getNamePath, getValue } from \"./utils/valueUtil\";\nimport { useEvent } from '@rc-component/util';\nexport function stringify(value) {\n  try {\n    return JSON.stringify(value);\n  } catch {\n    return Math.random();\n  }\n}\n\n// ------- selector type -------\n\n// ------- selector type end -------\n\nfunction useWatch(...args) {\n  const [dependencies, _form = {}] = args;\n  const options = isFormInstance(_form) ? {\n    form: _form\n  } : _form;\n  const form = options.form;\n  const [value, setValue] = useState(() => typeof dependencies === 'function' ? dependencies({}) : undefined);\n  const valueStr = useMemo(() => stringify(value), [value]);\n  const valueStrRef = useRef(valueStr);\n  valueStrRef.current = valueStr;\n  const fieldContext = useContext(FieldContext);\n  const formInstance = form || fieldContext;\n  const isValidForm = formInstance && formInstance._init;\n\n  // Warning if not exist form instance\n  if (process.env.NODE_ENV !== 'production') {\n    warning(args.length === 2 ? form ? isValidForm : true : isValidForm, 'useWatch requires a form instance since it can not auto detect from context.');\n  }\n\n  // ============================== Form ==============================\n  const {\n    getFieldsValue,\n    getInternalHooks\n  } = formInstance;\n  const {\n    registerWatch\n  } = getInternalHooks(HOOK_MARK);\n\n  // ============================= Update =============================\n  const triggerUpdate = useEvent((values, allValues) => {\n    const watchValue = options.preserve ? allValues ?? getFieldsValue(true) : values ?? getFieldsValue();\n    const nextValue = typeof dependencies === 'function' ? dependencies(watchValue) : getValue(watchValue, getNamePath(dependencies));\n    if (stringify(value) !== stringify(nextValue)) {\n      setValue(nextValue);\n    }\n  });\n\n  // ============================= Effect =============================\n  const flattenDeps = typeof dependencies === 'function' ? dependencies : JSON.stringify(dependencies);\n\n  // Deps changed\n  useEffect(() => {\n    // Skip if not exist form instance\n    if (!isValidForm) {\n      return;\n    }\n    triggerUpdate();\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isValidForm, flattenDeps]);\n\n  // Value changed\n  useEffect(() => {\n    // Skip if not exist form instance\n    if (!isValidForm) {\n      return;\n    }\n    const cancelRegister = registerWatch((values, allValues) => {\n      triggerUpdate(values, allValues);\n    });\n    return cancelRegister;\n\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [isValidForm]);\n  return value;\n}\nexport default useWatch;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}