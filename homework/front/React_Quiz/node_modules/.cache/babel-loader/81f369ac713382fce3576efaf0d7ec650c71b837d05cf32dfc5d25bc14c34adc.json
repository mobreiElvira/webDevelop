{"ast":null,"code":"import useState from \"@rc-component/util/es/hooks/useState\";\nimport * as React from 'react';\nimport { STEP_ACTIVATED, STEP_ACTIVE, STEP_NONE, STEP_PREPARE, STEP_PREPARED, STEP_START } from \"../interface\";\nimport useIsomorphicLayoutEffect from \"./useIsomorphicLayoutEffect\";\nimport useNextFrame from \"./useNextFrame\";\nconst FULL_STEP_QUEUE = [STEP_PREPARE, STEP_START, STEP_ACTIVE, STEP_ACTIVATED];\nconst SIMPLE_STEP_QUEUE = [STEP_PREPARE, STEP_PREPARED];\n\n/** Skip current step */\nexport const SkipStep = false;\n/** Current step should be update in */\nexport const DoStep = true;\nexport function isActive(step) {\n  return step === STEP_ACTIVE || step === STEP_ACTIVATED;\n}\nexport default (status, prepareOnly, callback) => {\n  const [step, setStep] = useState(STEP_NONE);\n  const [nextFrame, cancelNextFrame] = useNextFrame();\n  function startQueue() {\n    setStep(STEP_PREPARE, true);\n  }\n  const STEP_QUEUE = prepareOnly ? SIMPLE_STEP_QUEUE : FULL_STEP_QUEUE;\n  useIsomorphicLayoutEffect(() => {\n    if (step !== STEP_NONE && step !== STEP_ACTIVATED) {\n      const index = STEP_QUEUE.indexOf(step);\n      const nextStep = STEP_QUEUE[index + 1];\n      const result = callback(step);\n      if (result === SkipStep) {\n        // Skip when no needed\n        setStep(nextStep, true);\n      } else if (nextStep) {\n        // Do as frame for step update\n        nextFrame(info => {\n          function doNext() {\n            // Skip since current queue is ood\n            if (info.isCanceled()) return;\n            setStep(nextStep, true);\n          }\n          if (result === true) {\n            doNext();\n          } else {\n            // Only promise should be async\n            Promise.resolve(result).then(doNext);\n          }\n        });\n      }\n    }\n  }, [status, step]);\n  React.useEffect(() => () => {\n    cancelNextFrame();\n  }, []);\n  return [startQueue, step];\n};","map":{"version":3,"names":["useState","React","STEP_ACTIVATED","STEP_ACTIVE","STEP_NONE","STEP_PREPARE","STEP_PREPARED","STEP_START","useIsomorphicLayoutEffect","useNextFrame","FULL_STEP_QUEUE","SIMPLE_STEP_QUEUE","SkipStep","DoStep","isActive","step","status","prepareOnly","callback","setStep","nextFrame","cancelNextFrame","startQueue","STEP_QUEUE","index","indexOf","nextStep","result","info","doNext","isCanceled","Promise","resolve","then","useEffect"],"sources":["F:/综合/个人/作业/主课/大三/web开发/homework/front/React_Quiz/node_modules/@rc-component/motion/es/hooks/useStepQueue.js"],"sourcesContent":["import useState from \"@rc-component/util/es/hooks/useState\";\nimport * as React from 'react';\nimport { STEP_ACTIVATED, STEP_ACTIVE, STEP_NONE, STEP_PREPARE, STEP_PREPARED, STEP_START } from \"../interface\";\nimport useIsomorphicLayoutEffect from \"./useIsomorphicLayoutEffect\";\nimport useNextFrame from \"./useNextFrame\";\nconst FULL_STEP_QUEUE = [STEP_PREPARE, STEP_START, STEP_ACTIVE, STEP_ACTIVATED];\nconst SIMPLE_STEP_QUEUE = [STEP_PREPARE, STEP_PREPARED];\n\n/** Skip current step */\nexport const SkipStep = false;\n/** Current step should be update in */\nexport const DoStep = true;\nexport function isActive(step) {\n  return step === STEP_ACTIVE || step === STEP_ACTIVATED;\n}\nexport default ((status, prepareOnly, callback) => {\n  const [step, setStep] = useState(STEP_NONE);\n  const [nextFrame, cancelNextFrame] = useNextFrame();\n  function startQueue() {\n    setStep(STEP_PREPARE, true);\n  }\n  const STEP_QUEUE = prepareOnly ? SIMPLE_STEP_QUEUE : FULL_STEP_QUEUE;\n  useIsomorphicLayoutEffect(() => {\n    if (step !== STEP_NONE && step !== STEP_ACTIVATED) {\n      const index = STEP_QUEUE.indexOf(step);\n      const nextStep = STEP_QUEUE[index + 1];\n      const result = callback(step);\n      if (result === SkipStep) {\n        // Skip when no needed\n        setStep(nextStep, true);\n      } else if (nextStep) {\n        // Do as frame for step update\n        nextFrame(info => {\n          function doNext() {\n            // Skip since current queue is ood\n            if (info.isCanceled()) return;\n            setStep(nextStep, true);\n          }\n          if (result === true) {\n            doNext();\n          } else {\n            // Only promise should be async\n            Promise.resolve(result).then(doNext);\n          }\n        });\n      }\n    }\n  }, [status, step]);\n  React.useEffect(() => () => {\n    cancelNextFrame();\n  }, []);\n  return [startQueue, step];\n});"],"mappings":"AAAA,OAAOA,QAAQ,MAAM,sCAAsC;AAC3D,OAAO,KAAKC,KAAK,MAAM,OAAO;AAC9B,SAASC,cAAc,EAAEC,WAAW,EAAEC,SAAS,EAAEC,YAAY,EAAEC,aAAa,EAAEC,UAAU,QAAQ,cAAc;AAC9G,OAAOC,yBAAyB,MAAM,6BAA6B;AACnE,OAAOC,YAAY,MAAM,gBAAgB;AACzC,MAAMC,eAAe,GAAG,CAACL,YAAY,EAAEE,UAAU,EAAEJ,WAAW,EAAED,cAAc,CAAC;AAC/E,MAAMS,iBAAiB,GAAG,CAACN,YAAY,EAAEC,aAAa,CAAC;;AAEvD;AACA,OAAO,MAAMM,QAAQ,GAAG,KAAK;AAC7B;AACA,OAAO,MAAMC,MAAM,GAAG,IAAI;AAC1B,OAAO,SAASC,QAAQA,CAACC,IAAI,EAAE;EAC7B,OAAOA,IAAI,KAAKZ,WAAW,IAAIY,IAAI,KAAKb,cAAc;AACxD;AACA,eAAgB,CAACc,MAAM,EAAEC,WAAW,EAAEC,QAAQ,KAAK;EACjD,MAAM,CAACH,IAAI,EAAEI,OAAO,CAAC,GAAGnB,QAAQ,CAACI,SAAS,CAAC;EAC3C,MAAM,CAACgB,SAAS,EAAEC,eAAe,CAAC,GAAGZ,YAAY,CAAC,CAAC;EACnD,SAASa,UAAUA,CAAA,EAAG;IACpBH,OAAO,CAACd,YAAY,EAAE,IAAI,CAAC;EAC7B;EACA,MAAMkB,UAAU,GAAGN,WAAW,GAAGN,iBAAiB,GAAGD,eAAe;EACpEF,yBAAyB,CAAC,MAAM;IAC9B,IAAIO,IAAI,KAAKX,SAAS,IAAIW,IAAI,KAAKb,cAAc,EAAE;MACjD,MAAMsB,KAAK,GAAGD,UAAU,CAACE,OAAO,CAACV,IAAI,CAAC;MACtC,MAAMW,QAAQ,GAAGH,UAAU,CAACC,KAAK,GAAG,CAAC,CAAC;MACtC,MAAMG,MAAM,GAAGT,QAAQ,CAACH,IAAI,CAAC;MAC7B,IAAIY,MAAM,KAAKf,QAAQ,EAAE;QACvB;QACAO,OAAO,CAACO,QAAQ,EAAE,IAAI,CAAC;MACzB,CAAC,MAAM,IAAIA,QAAQ,EAAE;QACnB;QACAN,SAAS,CAACQ,IAAI,IAAI;UAChB,SAASC,MAAMA,CAAA,EAAG;YAChB;YACA,IAAID,IAAI,CAACE,UAAU,CAAC,CAAC,EAAE;YACvBX,OAAO,CAACO,QAAQ,EAAE,IAAI,CAAC;UACzB;UACA,IAAIC,MAAM,KAAK,IAAI,EAAE;YACnBE,MAAM,CAAC,CAAC;UACV,CAAC,MAAM;YACL;YACAE,OAAO,CAACC,OAAO,CAACL,MAAM,CAAC,CAACM,IAAI,CAACJ,MAAM,CAAC;UACtC;QACF,CAAC,CAAC;MACJ;IACF;EACF,CAAC,EAAE,CAACb,MAAM,EAAED,IAAI,CAAC,CAAC;EAClBd,KAAK,CAACiC,SAAS,CAAC,MAAM,MAAM;IAC1Bb,eAAe,CAAC,CAAC;EACnB,CAAC,EAAE,EAAE,CAAC;EACN,OAAO,CAACC,UAAU,EAAEP,IAAI,CAAC;AAC3B,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}